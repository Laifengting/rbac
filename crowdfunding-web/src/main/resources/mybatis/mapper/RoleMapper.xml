<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
	namespace:名称空间（类似于包名+类名，用于找到 SQL 语句所有的 mapper.xml 文件）
	指定为接口的全类名
-->
<mapper namespace = "com.lft.rbac.mapper.RoleMapper">
    <!--<cache/>-->

    <insert id = "insert">
        INSERT INTO t_role(name, gmt_created)
            VALUES (#{name}, #{gmtCreated})
    </insert>

    <insert id = "doAssign">
        INSERT INTO t_role_permission(role_id, permission_id, gmt_created)
        VALUES
        <foreach collection = "permissionIds"
                 item = "permissionId"
                 separator = ",">
            (#{roleId},#{permissionId},#{gmtCreated})
        </foreach>
    </insert>

    <update id = "updateRole">
        UPDATE t_role
        SET
            name=#{name}
            WHERE id = #{id}
    </update>

    <delete id = "deleteById">
        DELETE
            FROM t_role
            WHERE id = #{id}
    </delete>

    <delete id = "batchDeleteByIds">
        DELETE FROM t_role WHERE id IN
        <foreach collection = "ids"
                 item = "id"
                 open = "("
                 separator = ","
                 close = ")">
            #{id}
        </foreach>
    </delete>
    <delete id = "clearOld">
        DELETE
            FROM t_role_permission
            WHERE role_id = #{roleId};
    </delete>

    <select id = "selectDatePage"
            resultType = "com.lft.rbac.entity.Role">
        SELECT id, name, gmt_created
        FROM t_role
        <if test = "queryText != null &amp;&amp; queryText != ''">
            WHERE name LIKE CONCAT('%',#{queryText},'%')
        </if>
        ORDER BY gmt_created DESC
        LIMIT #{start},#{size}
    </select>

    <select id = "selectRolesCount"
            resultType = "java.lang.Integer">
        SELECT COUNT(*)
        FROM t_role
        <if test = "queryText != null &amp;&amp; queryText != ''">
            WHERE name LIKE CONCAT('%',#{queryText},'%')
        </if>
    </select>

    <select id = "selectRoleById"
            resultType = "com.lft.rbac.entity.Role">
        SELECT id, name, gmt_created
            FROM t_role
            WHERE id = #{id}
    </select>

    <select id = "selectAllRoles"
            resultType = "com.lft.rbac.entity.Role">
        SELECT id, name, gmt_created
            FROM t_role;
    </select>

</mapper>
