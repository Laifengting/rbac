<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
	namespace:名称空间（类似于包名+类名，用于找到 SQL 语句所有的 mapper.xml 文件）
	指定为接口的全类名
-->
<mapper namespace = "com.lft.rbac.mapper.UserMapper">
    <!--<cache/>-->
    <insert id = "insert">
        INSERT INTO t_user(username, loginacct, userpwd, email, gmt_created)
            VALUES (#{username}, #{loginacct}, #{userpwd}, #{email}, #{gmtCreated})
    </insert>
    <insert id = "insertUserRoles">
        INSERT INTO t_user_role(user_id, role_id, gmt_created)
        VALUES
        <foreach collection = "roleIds"
                 item = "roleId"
                 separator = ",">
            (#{userId},#{roleId},#{gmtCreated})
        </foreach>
    </insert>
    <update id = "update">
        UPDATE t_user
        SET
            username=#{username}, loginacct=#{loginacct}, email=#{email}
            WHERE id = #{id}
    </update>
    <delete id = "delete">
        DELETE
            FROM t_user
            WHERE id = #{id}
    </delete>

    <delete id = "batchDelete">
        DELETE
        FROM t_user
        WHERE id IN
        <foreach collection = "ids"
                 item = "id"
                 open = "("
                 separator = ","
                 close = ")">
            #{id}
        </foreach>
    </delete>
    <delete id = "deleteUserRoles">
        DELETE FROM t_user_role
        WHERE user_id = #{userId} AND role_id IN
        <foreach collection = "roleIds"
                 item = "roleId"
                 open = "("
                 separator = ","
                 close = ")">
            #{roleId}
        </foreach>
    </delete>
    <select id = "selectAllUsers"
            resultType = "com.lft.rbac.entity.User">
        SELECT id, username, loginacct, userpwd, email, gmt_created
            FROM t_user
    </select>

    <select id = "selectUser4Login"
            resultType = "com.lft.rbac.entity.User">
        SELECT id, username, loginacct, userpwd, email, gmt_created
            FROM t_user
            WHERE loginacct = #{loginacct} AND userpwd = #{userpwd}
    </select>

    <select id = "selectDatePage"
            resultType = "com.lft.rbac.entity.User">
        SELECT id, username, loginacct, userpwd, email, gmt_created
        FROM t_user
        <if test = "queryText != null &amp;&amp; queryText != ''">
            WHERE loginacct LIKE CONCAT('%',#{queryText},'%')
        </if>
        ORDER BY gmt_created DESC
        LIMIT #{start},#{size}
    </select>
    <select id = "selectUsersCount"
            resultType = "java.lang.Integer">
        SELECT COUNT(*)
        FROM t_user
        <if test = "queryText != null &amp;&amp; queryText != ''">
            WHERE loginacct LIKE CONCAT('%',#{queryText},'%')
        </if>
    </select>
    <select id = "selectUserById"
            resultType = "com.lft.rbac.entity.User">
        SELECT id, username, loginacct, userpwd, email, gmt_created
            FROM t_user
            WHERE id = #{id}
    </select>
    <select id = "queryRolesByUserId"
            resultType = "java.lang.Long">
        SELECT role_id
            FROM t_user_role
            WHERE user_id = #{id}
    </select>
</mapper>
